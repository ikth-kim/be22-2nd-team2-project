### ===================================================================
### ğŸ“˜ Next Page MSA Integrated Test Suite (Full Coverage)
### ===================================================================
### ì´ íŒŒì¼ì€ [IntelliJ HTTP Client]ë¥¼ ì‚¬ìš©í•˜ì—¬ MSA í™˜ê²½ì˜ ëª¨ë“  APIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
### ëª¨ë“  ìš”ì²­ì€ API Gateway (Port 8000)ë¥¼ ê²½ìœ í•˜ì—¬ ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.
###
### ğŸ“Œ ì‹œë‚˜ë¦¬ì˜¤ íë¦„:
### 1. íšŒì› ê°€ì… ë° ì¸ì¦ (Member)
### 2. ì†Œì„¤ ìƒì„± ë° ê´€ë¦¬ (Story)
### 3. ë°˜ì‘ ë° íˆ¬í‘œ (Reaction)
### 4. ê´€ë¦¬ì ê¸°ëŠ¥ ë° ì‚­ì œ (Admin)
### ===================================================================

### ğŸŒ Global Configuration
@gatewayUrl = http://localhost:8000
@contentType = application/json

### ===================================================================
### 1ï¸âƒ£ íšŒì› ê´€ë¦¬ (Member Service)
### ===================================================================

### 1-1. ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ (Check Email)
GET {{gatewayUrl}}/api/auth/check-email?email=msa_tester@example.com

### 1-2. ë‹‰ë„¤ì„ ì¤‘ë³µ ì²´í¬ (Check Nickname)
GET {{gatewayUrl}}/api/auth/check-nickname?nickname=MSAí…ŒìŠ¤í„°

### 1-3. íšŒì›ê°€ì… (Sign Up)
# @name signup
POST {{gatewayUrl}}/api/auth/signup
Content-Type: {{contentType}}

{
  "userEmail": "msa_tester@example.com",
  "userPw": "test1234!",
  "userNicknm": "MSAí…ŒìŠ¤í„°"
}

### 1-4. ë¡œê·¸ì¸ (Login) & í† í° ë°œê¸‰
# @name login
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "msa_tester@example.com",
  "userPw": "test1234!"
}

> {%
  // ì‘ë‹µì—ì„œ AccessTokenê³¼ RefreshTokenì„ ì¶”ì¶œí•˜ì—¬ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
  client.global.set("accessToken", response.body.data.accessToken);
  client.global.set("refreshToken", response.body.data.refreshToken); // ì¿ í‚¤ ì™¸ì— í•„ìš”ì‹œ ì‚¬ìš©
  client.log("âœ… ì¸ì¦ í† í°ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤");
%}

### 1-5. í† í° ê°±ì‹  (Refresh Token)
# ì¿ í‚¤ì— ì €ì¥ëœ refreshTokenì´ ìë™ìœ¼ë¡œ ì „ì†¡ë¨
POST {{gatewayUrl}}/api/auth/refresh

### 1-6. ë‚´ ì •ë³´ ì¡°íšŒ (My Page)
# [ì°¸ê³ ] Gatewayì™€ Member Serviceì—ì„œ ê°ê° ìš”ì²­ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ ë¡œê·¸ê°€ 2ë²ˆ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì •ìƒ ë™ì‘).
GET {{gatewayUrl}}/api/members/me
Authorization: Bearer {{accessToken}}


### ===================================================================
### 2ï¸âƒ£ ì†Œì„¤ ì§‘í•„ ë° ê´€ë¦¬ (Story Service)
### ===================================================================

### 2-1. ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ
GET {{gatewayUrl}}/api/categories

### 2-2. ì†Œì„¤ ìƒì„± (Create Book)
# @name createBook
POST {{gatewayUrl}}/api/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "title": "MSA ì•„í‚¤í…ì²˜ì˜ ë¹„ë°€",
  "categoryId": "THRILLER",
  "maxSequence": 5,
  "firstSentence": "ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ë¶„ë¦¬ëœ ê·¸ë‚ , ìš°ë¦¬ëŠ” Gateway ì•ì— ëª¨ì˜€ë‹¤."
}

> {%
  client.global.set("bookId", response.body.data);
  client.log("ğŸ“˜ ìƒì„±ëœ ì†Œì„¤ ID: " + response.body.data);
%}

### 2-3. ì†Œì„¤ ëª©ë¡ ì¡°íšŒ (List Books)
GET {{gatewayUrl}}/api/books?page=0&size=10&sort=createdAt,desc

### 2-4. ì†Œì„¤ ìƒì„¸ ì¡°íšŒ (Book Detail)
GET {{gatewayUrl}}/api/books/{{bookId}}

### 2-4-1. [User 2] ë¬¸ì¥ ì‘ì„±ì„ ìœ„í•œ ë‘ ë²ˆì§¸ ìœ ì € ê°€ì… & ë¡œê·¸ì¸
# ë³¸ì¸ ì†Œì„¤ì—ëŠ” ë¬¸ì¥ì„ ì—°ì†í•´ì„œ ì“¸ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ë‘ ë²ˆì§¸ ìœ ì € ìƒì„±
POST {{gatewayUrl}}/api/auth/signup
Content-Type: {{contentType}}

{
  "userEmail": "writer2@example.com",
  "userPw": "test1234!",
  "userNicknm": "ì´ì–´ì“°ê¸°ì‘ê°€"
}

### 2-4-2. [User 2] ë¡œê·¸ì¸
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "writer2@example.com",
  "userPw": "test1234!"
}

> {%
  client.global.set("accessToken2", response.body.data.accessToken);
  client.log("âœ… ì´ì–´ì“°ê¸° ì‘ê°€(User 2) í† í° ë°œê¸‰ ì™„ë£Œ");
%}

### 2-5. ë¬¸ì¥ ì´ì–´ì“°ê¸° (User 2 Append Sentence)
# @name appendSentence
POST {{gatewayUrl}}/api/books/{{bookId}}/sentences
Authorization: Bearer {{accessToken2}}
Content-Type: {{contentType}}

{
  "content": "íŠ¸ë˜í”½ì´ í­ì£¼í•´ë„ Circuit Breakerê°€ ìš°ë¦´ ì§€ì¼œì¤„ ê²ƒì´ë‹¤."
}

> {%
  client.global.set("sentenceId", response.body.data);
%}

### 2-5-1. [User 2] ë¡œê·¸ì•„ì›ƒ
# ë‹¤ìŒ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì´ì–´ì“°ê¸° ì‘ê°€ ë¡œê·¸ì•„ì›ƒ
POST {{gatewayUrl}}/api/auth/logout

### 2-6. ë‚´ê°€ ì“´ ë¬¸ì¥ ì¡°íšŒ
GET {{gatewayUrl}}/api/books/mysentences
Authorization: Bearer {{accessToken}}

### 2-7. ì†Œì„¤ ì œëª© ìˆ˜ì • (Update Title)
PATCH {{gatewayUrl}}/api/books/{{bookId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "title": "MSA ì•„í‚¤í…ì²˜ì˜ ì§„ì‹¤"
}

### 2-8. ë¬¸ì¥ ìˆ˜ì • (Update Sentence)
# ì£¼ì˜: User 2ê°€ ì‘ì„±í•œ ë¬¸ì¥ì´ì§€ë§Œ, User 1(Owner)ì´ ìˆ˜ì • ê°€ëŠ¥í•œì§€ í˜¹ì€ User 2ë¡œ ì¬ë¡œê·¸ì¸ í•„ìš”í•œì§€ í™•ì¸ í•„ìš”.
# í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ìƒ User 1(Owner) í† í° ì‚¬ìš©
PATCH {{gatewayUrl}}/api/books/{{bookId}}/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "content": "íŠ¸ë˜í”½ì´ í­ì£¼í•˜ì Circuit Breakerê°€ ì‘ë™í–ˆë‹¤."
}

### ===================================================================
### 3ï¸âƒ£ ë°˜ì‘ ë° íˆ¬í‘œ (Reaction Service)
### ===================================================================

### 3-1. ëŒ“ê¸€ ì‘ì„± (Add Comment)
POST {{gatewayUrl}}/api/reactions/comments
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "content": "ì •ë§ í¥ë¯¸ì§„ì§„í•œ ì•„í‚¤í…ì²˜ ì´ì•¼ê¸°ë„¤ìš”!"
}

> {%
  client.global.set("commentId", response.body.data);
%}

### 3-2. ì†Œì„¤ ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
GET {{gatewayUrl}}/api/reactions/comments/{{bookId}}

### 3-3. ëŒ“ê¸€ ìˆ˜ì • (Update Comment)
PATCH {{gatewayUrl}}/api/reactions/comments/{{commentId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "content": "ìˆ˜ì •ëœ ëŒ“ê¸€ì…ë‹ˆë‹¤: MSAëŠ” ì–´ë µì§€ë§Œ ì¬ë°Œì–´ìš”."
}

### 3-4. ì†Œì„¤ íˆ¬í‘œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
### [ì„¤ëª…] ì¢‹ì•„ìš” -> ì‹«ì–´ìš”(ë³€ê²½) -> ì‹«ì–´ìš”(ì·¨ì†Œ)

# 3-4-1. ì¢‹ì•„ìš” (ìµœì´ˆ)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "LIKE"
}
> {%
  client.test("Book Vote Like", function() {
      client.assert(response.body.data === true, "Vote should be true");
  });
%}

###

# 3-4-2. ì‹«ì–´ìš” (ë³€ê²½)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "DISLIKE"
}

###

# 3-4-3. ì‹«ì–´ìš” (ì·¨ì†Œ)
POST {{gatewayUrl}}/api/reactions/votes/books
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "bookId": {{bookId}},
  "voteType": "DISLIKE"
}
> {%
  client.test("Book Vote Cancel", function() {
      client.assert(response.body.data === false, "Vote should be canceled (false)");
  });
%}

### 3-5. ë¬¸ì¥ íˆ¬í‘œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
### [ì„¤ëª…] ì‹«ì–´ìš” -> ì¢‹ì•„ìš”(ë³€ê²½) -> ì¢‹ì•„ìš”(ì·¨ì†Œ)

# 3-5-1. ì‹«ì–´ìš” (ìµœì´ˆ)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "DISLIKE"
}

# 3-5-2. ì¢‹ì•„ìš” (ë³€ê²½)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "LIKE"
}

# 3-5-3. ì¢‹ì•„ìš” (ì·¨ì†Œ)
POST {{gatewayUrl}}/api/reactions/votes/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}
Content-Type: {{contentType}}

{
  "voteType": "LIKE"
}

### 3-6. ëŒ“ê¸€ ì‚­ì œ
DELETE {{gatewayUrl}}/api/reactions/comments/{{commentId}}
Authorization: Bearer {{accessToken}}


### ===================================================================
### 4ï¸âƒ£ ê´€ë¦¬ì ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ (Admin Approval Flow)
### í”„ë¡œì„¸ìŠ¤: ê°€ì… ì‹ ì²­(Pending) -> ë¡œê·¸ì¸ ì‹œë„(ì‹¤íŒ¨) -> ìŠ¹ì¸(By Super Admin) -> ë¡œê·¸ì¸(ì„±ê³µ)
### ===================================================================

### 4-1. ì‹ ê·œ ê´€ë¦¬ì ê°€ì… ì‹ ì²­ (Admin Signup)
# ì˜ˆìƒ ê²°ê³¼: 200 OK ("ê´€ë¦¬ì ê°€ì… ì‹ ì²­ ì„±ê³µ (ìŠ¹ì¸ ëŒ€ê¸°)")
POST {{gatewayUrl}}/api/auth/admin
Content-Type: {{contentType}}

{
  "userEmail": "new_admin@nextpage.com",
  "userPw": "admin1234!",
  "userNicknm": "ì‹ ê·œê´€ë¦¬ì"
}

> {%
  client.test("Admin Signup Pending", function() {
    client.assert(response.status === 200, "Status code should be 200");
  });
%}

### 4-2. ìŠ¹ì¸ ì „ ë¡œê·¸ì¸ ì‹œë„ (Login Attempt - Should Fail)
# ì˜ˆìƒ ê²°ê³¼: 403 Forbidden (ACCOUNT_APPROVAL_PENDING Error Code: A005)
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "new_admin@nextpage.com",
  "userPw": "admin1234!"
}

> {%
  client.test("Login Failed (Pending)", function() {
    client.assert(response.status === 403, "Should return 403 Forbidden");
    client.assert(response.body.error.code === "A005", "Error code should be A005");
  });
%}

### 4-3. ê¸°ì¡´ ê´€ë¦¬ì(Super Admin) ë¡œê·¸ì¸
# DB ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ì— í¬í•¨ëœ ê¸°ë³¸ ê´€ë¦¬ì ê³„ì • (admin@nextpage.com)
# @name superAdminLogin
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "admin@nextpage.com",
  "userPw": "password123"
}

> {%
  client.global.set("adminToken", response.body.data.accessToken);
  client.log("ğŸ—ï¸ ìŠˆí¼ ê´€ë¦¬ì í† í° ë°œê¸‰ ì™„ë£Œ");
%}

### 4-4. ì‹ ê·œ ê´€ë¦¬ì ìŠ¹ì¸ (Approve Admin)
# 4-1ì—ì„œ ìƒì„±ëœ ì‹ ê·œ ê´€ë¦¬ìì˜ IDë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.
# (ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” DBì—ì„œ IDë¥¼ í™•ì¸í•˜ê±°ë‚˜, ê°€ì… ì‘ë‹µì— IDê°€ í¬í•¨ë˜ë„ë¡ API ìˆ˜ì • í•„ìš”. ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œ ID ì‚¬ìš©)
PATCH {{gatewayUrl}}/api/auth/admin/approve/5
Authorization: Bearer {{adminToken}}

### 4-4-1. [Super Admin] ë¡œê·¸ì•„ì›ƒ
POST {{gatewayUrl}}/api/auth/logout

### 4-5. ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ ì¬ì‹œë„ (Login Attempt - Should Success)
# ì˜ˆìƒ ê²°ê³¼: 200 OK
POST {{gatewayUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "userEmail": "new_admin@nextpage.com",
  "userPw": "admin1234!"
}

> {%
  client.test("Login Success (Approved)", function() {
    client.assert(response.status === 200, "Should return 200 OK");
  });
%}

### ===================================================================
### 5ï¸âƒ£ ê´€ë¦¬ì ë° ì‘ì„±ì ê¸°ëŠ¥ (Content Management)
### ===================================================================

### 5-1. ë¬¸ì¥ ì‚­ì œ (Delete Sentence)
DELETE {{gatewayUrl}}/api/books/{{bookId}}/sentences/{{sentenceId}}
Authorization: Bearer {{accessToken}}

### 5-2. ì†Œì„¤ ì™„ê²° (Manual Complete) - maxSequence ë„ë‹¬ ì „ ê°•ì œ ì™„ê²°
POST {{gatewayUrl}}/api/books/{{bookId}}/complete
Authorization: Bearer {{accessToken}}

### 5-3. ì†Œì„¤ ì‚­ì œ (Delete Book)
DELETE {{gatewayUrl}}/api/books/{{bookId}}
Authorization: Bearer {{accessToken}}

### ===================================================================
### 6ï¸âƒ£ ë°ì´í„° ì •ë¦¬ (Cleanup)
### ===================================================================

### 6-1. í…ŒìŠ¤íŠ¸ ê³„ì • íƒˆí‡´
DELETE {{gatewayUrl}}/api/auth/withdraw
Authorization: Bearer {{accessToken}}
