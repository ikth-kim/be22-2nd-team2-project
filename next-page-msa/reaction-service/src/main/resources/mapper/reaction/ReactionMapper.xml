<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team2.reactionservice.query.reaction.mapper.ReactionMapper">

    <!-- 소설의 댓글 목록 조회 (MSA: writerNicknm은 Feign Client로 조회) -->
    <select id="findCommentsByBookId" resultType="CommentDto">
        SELECT
            c.comment_id,
            c.content,
            c.writer_id,
            c.created_at,
            c.parent_id AS parentId
        FROM comments c
        WHERE c.book_id = #{bookId}
          AND c.deleted_at IS NULL
        ORDER BY c.created_at ASC, c.comment_id ASC
    </select>

    <!-- 특정 사용자가 쓴 댓글 조회 (MSA: writerNicknm, bookTitle은 Feign Client로 조회) -->
    <select id="findCommentsByWriterId" resultType="CommentDto">
        SELECT
            c.comment_id,
            c.content,
            c.writer_id,
            c.created_at,
            c.parent_id AS parentId,
            c.book_id
        FROM comments c
        WHERE c.writer_id = #{writerId}
          AND c.deleted_at IS NULL
        ORDER BY c.created_at DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 특정 사용자가 쓴 댓글 개수 조회 -->
    <select id="countCommentsByWriterId" resultType="long">
        SELECT COUNT(*)
        FROM comments
        WHERE writer_id = #{writerId}
          AND deleted_at IS NULL
    </select>
</mapper>